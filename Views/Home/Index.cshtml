@{
    ViewBag.Title = "CivicLink - Municipal Services";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var userEngagement = ViewBag.UserEngagement as CivicLink.Models.UserEngagement;
}

<div class="container-fluid" style="margin-top: 2rem;">
    <!-- Hero Section -->
    <div class="hero-section glass-card">
        <h1 class="hero-title">CivicLink</h1>
        <p class="hero-subtitle">Connecting citizens with municipal services for a better community</p>

        @if (userEngagement != null)
        {
            <!-- User Stats Display -->
            <div class="user-stats" style="max-width: 600px; margin: 2rem auto 0;">
                <div class="row">
                    <div class="col-4">
                        <div class="stat-item">
                            <span class="stat-number">@userEngagement.Level</span>
                            <span class="stat-label">Level</span>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stat-item">
                            <span class="stat-number">@userEngagement.Points</span>
                            <span class="stat-label">Points</span>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stat-item">
                            <span class="stat-number">@userEngagement.IssuesReported</span>
                            <span class="stat-label">Reports</span>
                        </div>
                    </div>
                </div>

                @if (userEngagement.Badges.Any())
                {
                    <div class="badge-container justify-content-center">
                        @foreach (var badge in userEngagement.Badges.Take(3))
                        {
                            <div class="badge-item earned">
                                <i class="@badge.IconClass badge-icon"></i>
                                <span>@badge.Name</span>
                            </div>
                        }
                        @if (userEngagement.Badges.Count > 3)
                        {
                            <div class="badge-item">
                                <span>+@(userEngagement.Badges.Count - 3) more</span>
                            </div>
                        }
                    </div>
                }
            </div>
        }
    </div>

    <!-- Service Options -->
    <div class="row g-4">
        <!-- Report Issues Card -->
        <div class="col-lg-4 col-md-6">
            <div class="service-card">
                <i class="fas fa-exclamation-triangle service-icon"></i>
                <h3 class="service-title">Report Issues</h3>
                <p class="service-description">
                    Report municipal issues in your community. From broken streetlights to water leaks,
                    help us keep our city running smoothly.
                </p>
                <a href="@Url.Action("ReportIssue", "Home")" class="btn btn-apple">
                    <i class="fas fa-plus me-2"></i>Report Now
                </a>
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-award me-1"></i>Earn 20-50 points per report
                    </small>
                </div>
            </div>
        </div>

        <!-- Local Events Card (Disabled) -->
        <div class="col-lg-4 col-md-6">
            <div class="service-card" style="opacity: 0.6;">
                <i class="fas fa-calendar-alt service-icon" style="color: var(--medium-gray);"></i>
                <h3 class="service-title" style="color: var(--medium-gray);">Local Events</h3>
                <p class="service-description">
                    Stay updated with community events, town hall meetings, and local announcements.
                </p>
                <button class="btn btn-disabled" disabled>
                    <i class="fas fa-lock me-2"></i>Coming in Phase 2
                </button>
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>Available soon
                    </small>
                </div>
            </div>
        </div>

        <!-- Service Status Card (Disabled) -->
        <div class="col-lg-4 col-md-6">
            <div class="service-card" style="opacity: 0.6;">
                <i class="fas fa-tasks service-icon" style="color: var(--medium-gray);"></i>
                <h3 class="service-title" style="color: var(--medium-gray);">Request Status</h3>
                <p class="service-description">
                    Track the progress of your service requests and receive real-time updates.
                </p>
                <button class="btn btn-disabled" disabled>
                    <i class="fas fa-lock me-2"></i>Coming in Phase 2
                </button>
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>Available soon
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="glass-card" style="padding: 2rem;">
                <div class="row text-center">
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-item">
                            <i class="fas fa-users fa-2x text-primary mb-2"></i>
                            <div class="stat-number" style="color: var(--dark-color); font-size: 1.5rem;">1,247</div>
                            <div class="stat-label">Active Citizens</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-item">
                            <i class="fas fa-flag fa-2x text-success mb-2"></i>
                            <div class="stat-number" style="color: var(--dark-color); font-size: 1.5rem;">3,456</div>
                            <div class="stat-label">Issues Reported</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-item">
                            <i class="fas fa-check-circle fa-2x text-warning mb-2"></i>
                            <div class="stat-number" style="color: var(--dark-color); font-size: 1.5rem;">2,891</div>
                            <div class="stat-label">Issues Resolved</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-item">
                            <i class="fas fa-clock fa-2x text-info mb-2"></i>
                            <div class="stat-number" style="color: var(--dark-color); font-size: 1.5rem;">2.3 days</div>
                            <div class="stat-label">Avg. Response Time</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <div class="glass-card" style="padding: 2rem; background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));">
                <h4 style="margin-bottom: 1rem; font-weight: 600;">Make a Difference in Your Community</h4>
                <p style="color: var(--medium-gray); margin-bottom: 2rem;">
                    Every report helps us build a better, safer, and more efficient city for everyone.
                </p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="@Url.Action("ReportIssue", "Home")" class="btn btn-apple">
                        <i class="fas fa-plus me-2"></i>Report Your First Issue
                    </a>
                    <a href="@Url.Action("IssuesList", "Home")" class="btn btn-secondary-apple">
                        <i class="fas fa-list me-2"></i>View All Issues
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Add some interactive animations
    document.addEventListener('DOMContentLoaded', function () {
        // Animate stat numbers on scroll
        const animateNumbers = () => {
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach(stat => {
                const finalNumber = parseInt(stat.textContent.replace(/[^\d]/g, ''));
                if (finalNumber && !stat.hasAttribute('data-animated')) {
                    stat.setAttribute('data-animated', 'true');
                    animateValue(stat, 0, finalNumber, 2000);
                }
            });
        };

        const animateValue = (element, start, end, duration) => {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const current = Math.floor(progress * (end - start) + start);

                if (element.textContent.includes('days')) {
                    element.textContent = (current / 10).toFixed(1) + ' days';
                } else {
                    element.textContent = current.toLocaleString();
                }

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        };

        // Trigger animation when stats come into view
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateNumbers();
                }
            });
        });

        const statsSection = document.querySelector('.glass-card');
        if (statsSection) {
            observer.observe(statsSection);
        }

        // Add hover effect to service cards
        const serviceCards = document.querySelectorAll('.service-card');
        serviceCards.forEach(card => {
            card.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            });

            card.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    });
</script>